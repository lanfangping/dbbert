How do I speed up my Redshift queries? | Segment Documentation Home Getting Started Getting started with Segment What is Segment? A simple Segment installation Planning a full installation A full Segment installation
Sending data to destinations Testing and debugging What's next? Guides An introduction to Segment Segment developer overview Segment data user overview Segment workspace admin overview Filtering your Segment data How does Segment handle duplicate data?
How can I ignore internet bots? What is the difference between Segment and tag managers? What is Replay? How To Guides How-to Guides index How do I automate multi-channel re-engagement campaigns? Should I collect data on the client or server?
How do I collect page views on the server side? How do I create a push notification? How do we track your customers across channels and devices? How do I set up a dynamic coupon program to reward loyal customers? How do I forecast LTV with SQL and Excel for e-commerce?
How do I import historical data? How do I join user profiles? How do I measure my advertising funnel? How do I measure the ROI of my Marketing Campaigns? How do I migrate code from other analytics tools? What role does Segment play in Attribution?
How do we set up event-triggered notifications or alerts? Usage and Billing Account management Billing and account FAQs MTUs, Throughput and Billing Do you offer discounts or coupons? What is the Segment Startup Program? Connections Connections overview
The Segment Spec Spec overview Spec: Page Spec: Screen Spec: Track Spec: Group Spec: Identify Spec: Common Fields Native Mobile Spec What is the native mobile spec?
Packaging SDKs for mobile destinations Spec: Semantic Events Spec: B2B SaaS Spec: Ecommerce Events Ecommerce tracking plans Video Spec Best practices for identifying users Best practices for Event calls Sources Sources overview
Sources catalog Using the Source Debugger All about Cloud Sources Set up a custom domain proxy in Segment Visual Tagger Destinations Destinations overview Add a destination Destinations catalog Destination Filters Functions
Functions overview Source Functions Destination Functions Functions environment Functions usage limits Storage Destinations Storage Destinations overview Storage Destinations catalog Segment Data Lakes Data Lakes overview Set up Data Lakes
Sync Reports and error reporting Data Lakes vs Warehouses Data Warehouses Warehouses overview Warehouses schemas Warehouse selective sync Warehouse Health dashboards Choosing a warehouse Warehouse FAQs How do you add users?
What does my warehouse error mean? Redshift cluster and Redshift connector limitations How do I speed up my redshift queries? How do I test my connections? What are my data export options? How do I use Schema Controls? How do I check if data is reaching a destination?
How do I find my write key? Integration error codes Are there limits on my Segment Schema? Rate Limits and SLA Data Residency Personas Personas overview Personas Quickstart Guide Personas Identity Resolution Overview Onboarding
Use Cases External IDs Settings E-Commerce example Personas Space set up Computed Traits SQL Traits Audiences Overview Account-level Audiences Using Personas data
Personas and Warehouses Profile API Personas and GDPR Personas FAQs Rate Limits Privacy Privacy overview Privacy Portal Detect PII Data Controls and Alerts GDPR
Complying with GDPR User deletion and suppression Privacy FAQs Protocols Protocols overview Create a Tracking Plan Data collection best practices The Tracking Plan Tracking Plan Libraries Validate with violations
Connect Sources to your Tracking Plan Review and resolve event violations Forward violations Enforce with data controls Customize your schema controls Forward blocked events Transform to fix bad data Protocols Extensions Protocols APIs Typewriter Anomaly Detection
Protocols FAQs Segment App Introducing the Segment Web App Workspace Home Access Management Identity & Access Management overview Concepts Roles Manage workspace members Label-based access control Audit trail Single Sign On
Multi-Factor Authentication (MFA) Picking a secure password Prod and Testing environments in Segment How do I verify my email address? Partners Glossary Config API Help Release Notes Back to Segment.com Log in Sign Up
Home Getting Started Getting started with Segment What is Segment? A simple Segment installation Planning a full installation A full Segment installation Sending data to destinations Testing and debugging What's next? Guides
An introduction to Segment Segment developer overview Segment data user overview Segment workspace admin overview Filtering your Segment data How does Segment handle duplicate data? How can I ignore internet bots? What is the difference between Segment and tag managers?
What is Replay? How To Guides How-to Guides index How do I automate multi-channel re-engagement campaigns? Should I collect data on the client or server? How do I collect page views on the server side? How do I create a push notification?
How do we track your customers across channels and devices? How do I set up a dynamic coupon program to reward loyal customers? How do I forecast LTV with SQL and Excel for e-commerce? How do I import historical data? How do I join user profiles? How do I measure my advertising funnel?
How do I measure the ROI of my Marketing Campaigns? How do I migrate code from other analytics tools? What role does Segment play in Attribution? How do we set up event-triggered notifications or alerts? Usage and Billing Account management Billing and account FAQs
MTUs, Throughput and Billing Do you offer discounts or coupons? What is the Segment Startup Program? Connections Connections overview The Segment Spec Spec overview Spec: Page Spec: Screen Spec: Track Spec: Group
Spec: Identify Spec: Common Fields Native Mobile Spec What is the native mobile spec? Packaging SDKs for mobile destinations Spec: Semantic Events Spec: B2B SaaS Spec: Ecommerce Events
Ecommerce tracking plans Video Spec Best practices for identifying users Best practices for Event calls Sources Sources overview Sources catalog Using the Source Debugger All about Cloud Sources Set up a custom domain proxy in Segment Visual Tagger Destinations
Destinations overview Add a destination Destinations catalog Destination Filters Functions Functions overview Source Functions Destination Functions Functions environment Functions usage limits Storage Destinations Storage Destinations overview
Storage Destinations catalog Segment Data Lakes Data Lakes overview Set up Data Lakes Sync Reports and error reporting Data Lakes vs Warehouses Data Warehouses Warehouses overview Warehouses schemas Warehouse selective sync Warehouse Health dashboards
Choosing a warehouse Warehouse FAQs How do you add users? What does my warehouse error mean? Redshift cluster and Redshift connector limitations How do I speed up my redshift queries? How do I test my connections? What are my data export options?
How do I use Schema Controls? How do I check if data is reaching a destination? How do I find my write key? Integration error codes Are there limits on my Segment Schema? Rate Limits and SLA Data Residency Personas Personas overview
Personas Quickstart Guide Personas Identity Resolution Overview Onboarding Use Cases External IDs Settings E-Commerce example Personas Space set up Computed Traits SQL Traits Audiences Overview
Account-level Audiences Using Personas data Personas and Warehouses Profile API Personas and GDPR Personas FAQs Rate Limits Privacy Privacy overview Privacy Portal Detect PII
Data Controls and Alerts GDPR Complying with GDPR User deletion and suppression Privacy FAQs Protocols Protocols overview Create a Tracking Plan Data collection best practices The Tracking Plan Tracking Plan Libraries
Validate with violations Connect Sources to your Tracking Plan Review and resolve event violations Forward violations Enforce with data controls Customize your schema controls Forward blocked events Transform to fix bad data Protocols Extensions Protocols APIs Typewriter
Anomaly Detection Protocols FAQs Segment App Introducing the Segment Web App Workspace Home Access Management Identity & Access Management overview Concepts Roles Manage workspace members Label-based access control
Audit trail Single Sign On Multi-Factor Authentication (MFA) Picking a secure password Prod and Testing environments in Segment How do I verify my email address? Partners Glossary Config API Config API overview
API design Authentication Destination Filter Query Language Reference Creating a Javascript web source and Google Analytics destination Help Release Notes Back to Connections Email Marketing ActiveCampaign Airship
AutopilotHQ Blueshift Braze Bronto Courier Customer.io Drip Eloqua Email Aptitude Emarsys Exponea Extole Platform Freshmarketer
Gainsight PX Gist HubSpot Insider Intercom Iterable KISSmetrics Kahuna Klaviyo Leanplum MailChimp Mailjet Marketo Static Lists
Marketo V2 MoEngage Moosend Movable Ink Nudgespot OneSignal Pardot PersistIQ Personyze RadiumOne Connect Responsys Sailthru
Salescamp CRM Salesforce Marketing Cloud Seg Selligent Marketing Cloud Swrve Talon.One Trustpilot UserIQ Userlist Vero Voucherify WebEngage Wigzo
Wishpond Xtremepush Zaius Zendesk Connect hydra Advertising AdLearn Open Platform AdQuick AdRoll AdWords Remarketing Lists Adikteev
Adtriba AppNexus Bing Ads Blueshift ByteGain Criteo App & Web Events Criteo Offline Conversions DoubleClick Floodlight EPICA Everflow Facebook App Events
Facebook Conversions API Facebook Offline Conversions Facebook Pixel Firebase Flurry Google Ads (Classic) Google Ads (Gtag) HasOffers Inkit Kevel Kitemetrics
LinkedIn Insight Tag MediaMath Millennial Media Nanigans Perfect Audience Personas Display & Video 360 Personas Facebook Custom Audiences Pinterest Audiences Pinterest Tag Podsights Quantcast
QuanticMind Quora Conversion Pixel RadiumOne Connect ShareASale SimpleReach Snapchat Audiences TV Squared TrafficGuard Twitter Ads Yellowhammer Zaius Analytics
AdLearn Open Platform AdQuick Adobe Analytics Adtriba Alexa Algolia Insights Amazon Kinesis Amazon Kinesis Firehose Amazon S3 Amplitude Anodot Asayer
Auryc Beamer Blendo Bucket ByteGain Calixa Candu Chartbeat ClearBrain CleverTap Clicky Countly CrowdPower Cruncher
Custify CustomFit.ai CustomerSuccessBox Data Lakes DataBrain EMMA EPICA Emarsys Everflow Experiments by GrowthHackers Exponea Facebook App Events
FactorsAI Firebase Flurry FoxMetrics FunnelFox Gainsight Gainsight PX Gameball Gauges GoSquared Google Analytics Google Cloud Storage Heap
HitTail HubSpot IBM UBX Indicative Inkit Interana KISSmetrics Keen Kitemetrics Kubit Lantern LaunchDarkly Events Librato
Localytics Lytics Madkudu Matomo Maxia Mixpanel MoEngage Mutiny New Relic Nielsen DCR Parsely Pendo Pointillist PostHog
ProfitWell Quantcast Refersion Retina Richpanel SIGNL4 Alerting SMBStreams ScopeAI SegMetrics Serenytics Sherlock Singular SlicingDice
Smartlook Split Startdeliver Stories Stormly Strikedeck Survicate Swrve Tamber Tractionboard TrafficGuard Treasure Data Unwaffle UserIQ UserLeap
Vidora WalkMe WebEngage Whale Watch Wigzo Windsor Woopra Xtremepush Yandex Metrica Youbora comScore goedle.io hydra
Enrichment AdLearn Open Platform Clearbit Enrichment Clearbit Reveal Cruncher Hull Madkudu Modern Pricing Noora Refiner SMBStreams Survicate Vidora
A/B Testing AdLearn Open Platform Algolia Insights Apptimize ConvertFlow Criteo Offline Conversions CustomFit.ai Experiments by GrowthHackers Exponea Freshmarketer
FunnelEnvy Insider LaunchDarkly Events Leanplum Modern Pricing Monetate Mutiny Optimizely Full Stack Optimizely Web Personyze PostHog Proof Experiences
Split Tamber Taplytics Trackier Visual Website Optimizer Customer Success AdQuick Asayer Beamer Calixa Candu ChurnZero ClientSuccess
Courier Custify CustomFit.ai CustomerSuccessBox DataBrain Elevio Emarsys EnjoyHQ Gainsight Gainsight PX Hawkei Help Scout
Inkit Interana Intercom Kustomer Learndot Lou Moesif API Analytics Nat Natero Noora Planhat Ramen Refiner Retently Richpanel
Salescamp CRM Salesmachine SatisMeter Savio ScopeAI Sherlock Slack Snapboard Startdeliver Stonly Stormly Strikedeck Talon.One Totango
Trustpilot Unwaffle Upcall UserIQ UserLeap UserVoice Vitally Voucherify WalkMe Windsor Zendesk Zopim hydra
Performance Monitoring AdQuick Asayer Atatus BugHerd Bugsnag Button Callingly Crittercism Cruncher Custify CustomerSuccessBox Errorception
Experiments by GrowthHackers FunnelFox Hawkei Keen Lantern Moesif API Analytics New Relic Pingdom ProductBird Retina Rollbar SIGNL4 Alerting SegMetrics
Sentry Serenytics Snapboard Stormly Track JS TrafficGuard Attribution Adjust Adtriba AppsFlyer Attribution Branch Metrics Button Convertro
Criteo Offline Conversions Dreamdata IO EMMA Impact Partnership Cloud Improvely Interana Kitemetrics Kochava Localytics Lou Refersion Retina Rockerbox Singular
Stormly TUNE Tapstream TrafficGuard Deep Linking Adjust AppsFlyer Branch Metrics Button EMMA Singular Video Adobe Analytics Chartbeat
Nielsen DCR Parsely Youbora comScore SMS & Push Notifications Airship Batch Beamer Blueshift Braze Callingly CleverTap Courier Customer.io
EMMA Emarsys Flurry Gameball Insider Iterable Kahuna Leanplum Localytics MoEngage OneSignal Regal Voice SIGNL4 Alerting
Selligent Marketing Cloud Swrve Tamber User.com WebEngage Wigzo Xtremepush Zaius Zendesk Connect Marketing Automation Airship ByteGain Callingly
ClearBrain Courier CrowdPower CustomFit.ai DataBrain EPICA Emarsys Everflow Experiments by GrowthHackers Extole Platform Freshmarketer FunnelEnvy
Gist Inkit Insider Kitemetrics Mutiny Nat PersistIQ Personyze Proof Experiences Regal Voice Retina Salescamp CRM SegMetrics
Singular Startdeliver Stories Stormly Strikedeck Tamber Unwaffle Upcall Userlist Vidora Voucherify WebEngage Xtremepush hydra
Personalization Algolia Insights Amazon Personalize Appcues Button ByteGain Candu Chameleon ClearBrain ConvertFlow Criteo Offline Conversions Cruncher
CustomFit.ai DataBrain EPICA Exponea FunnelEnvy FunnelFox Gainsight PX Gameball Hello Bar Hull Insider Leanplum Lytics Modern Pricing
Monetate Movable Ink Mutiny Nat Optimizely Full Stack Optimizely Web Personyze ProductBird Proof Experiences Regal Voice Selligent Marketing Cloud Snapboard
Spinnakr Startdeliver Stonly Talon.One Tamber Unwaffle Upcall User.com UserLeap Userpilot Voucherify WebEngage Wigzo
Wishpond Xtremepush goedle.io tray.io Raw Data Amazon EventBridge Amazon Kinesis Amazon Kinesis Firehose Amazon Lambda Amazon S3 Anodot Asayer
Azure Function Blendo Calixa Cruncher Data Lakes Experiments by GrowthHackers FunnelFox Google Cloud Function Google Cloud PubSub Google Cloud Storage Hull Interana Iron.io
Keen Mammoth Maxia PostHog Repeater Serenytics SlicingDice Stitch Data Stories Treasure Data Vidora Webhooks Xplenty Zapier
tray.io Referrals Ambassador Attribution Extole Platform Friendbuy Gameball Impact Partnership Cloud Refersion SaaSquatch Talkable Talon.One Trustpilot Voucherify
Feature Flagging Apptimize LaunchDarkly Events Optimizely Full Stack Optimizely Web Split Heatmaps & Recordings Auryc Crazy Egg Freshmarketer FullStory Hotjar
Inspectlet Lucky Orange MouseStats Mouseflow Navilytics PostHog Smartlook Stories WalkMe mabl Surveys Auryc Beamer Canny ConvertFlow
Custify CustomerSuccessBox Delighted Gainsight Gainsight PX Lucky Orange Noora Pendo ProductBird Promoter.io Qualaroo Ramen Refiner
Retently SatisMeter Savio Stonly Strikedeck Survicate Trustpilot UserIQ UserLeap UserVoice WalkMe WebEngage Wootric
CRM Braze ByteGain Calixa CrowdPower Emarsys EnjoyHQ Firebase Freshsales FunnelFox GoSquared HubSpot Kustomer
Moesif API Analytics Nat Noora ProductBird Richpanel Sailthru Salescamp CRM Salesforce SegMetrics Startdeliver Strikedeck Userlist WebEngage
Whale Alerts Wigzo Windsor Wishpond Security & Fraud Castle Moesif API Analytics SIGNL4 Alerting Singular TrafficGuard Livechat Courier Drift Gist
GoSquared Intercom LiveChat Lucky Orange Olark Richpanel SnapEngage Zopim Tag Managers FunnelEnvy Google Tag Manager Email User.com
Back to Connections Server .NET Clojure HTTP API Java Node.js PHP Pixel Tracking API Python Ruby Email Marketing ActiveCampaign Airship
AutopilotHQ Blueshift Braze Customer.io Drip Facebook Lead Ads Intercom Iterable Klenty Leanplum Mailchimp Mailjet Mandrill Nudgespot
Selligent Marketing Cloud SendGrid Vero CRM Aircall HubSpot Moesif API Analytics Salesforce Helpdesk Aircall Zendesk Customer Success Aircall
Beamer Candu Moesif API Analytics ProveSource Refiner Marketing Automation Airship Foursquare Pilgrim ProveSource Regal Voice Selligent Marketing Cloud
SMS & Push Notifications Airship Beamer Braze Leanplum Regal Voice Selligent Marketing Cloud Twilio Custom Amazon S3 Analytics Amplitude Cohorts Beamer
Candu Looker Moesif API Analytics Pendo Youbora Mobile Android React Native Xamarin iOS Surveys Beamer Delighted Refiner Wootric
Personalization Candu Foursquare Pilgrim Leanplum ProveSource Regal Voice Livechat Chatlio Advertising Facebook Ads Google Ads ProveSource Enrichment
Foursquare Pilgrim Herow Radar Refiner Referrals Friendbuy Website Javascript Shopify (by Littledata) Feature Flagging LaunchDarkly A/B Testing LaunchDarkly
Leanplum Performance Monitoring Moesif API Analytics Ott Roku (alpha) Payments Stripe Home Connections Storage Warehouses How do I speed up my Redshift queries?
How do I speed up my Redshift queries? On this page Common Causes for Slow Queries Pro-tips for Segment Warehouses Waiting minutes and minutes, maybe even an hour, for your queries to compute is an unfortunate reality for many growing companies. Whether your data has grown faster than your cluster, or you’re running too many jobs in parallel, there are lots of reasons your queries might be slowing down.
To help you improve your query performance, this guide takes you through common issues and how to mitigate them. Common Causes for Slow Queries 1. Not enough space As your data volume grows and your team writes more queries, you might be running out of space in your cluster.
To check if you’re getting close to your max, run this query. It will tell you the percentage of storage used in your cluster. We recommend never exceeding 75-80% of your storage capacity. If you’re nearing capacity, consider adding some more nodes. Learn how to resize your cluster here. 2. Inefficient queries Another thing you’ll want to check is if your queries are efficient. For example, if you’re scanning an entire dataset with a query, you’re probably not making the best use of your compute resources.
A few tips for writing performant queries: Consider using INNER joins as they are are more efficient that LEFT joins. Stay away from UNION whenever possible. Specify multiple levels of conditionals when you can. Use EXPLAIN to show the query execution plan and cost.
To learn more about writing beautiful SQL, check out these resources: Periscope on Query Performance Mode on Performance Tuning SQL Queries Chartio on Improving Query Performance 3. Multiple ETL processes and queries running Some databases like Redshift have limited computing resources. Running multiple queries or ETL processes that insert data into your warehouse at the same time will compete for compute power.
If you have multiple ETL processes loading into your warehouse at the same time, especially when analysts are also trying to run queries, everything will slow down. Try to schedule them at different times and when your cluster is least active. If you’re a Segment Business Tier customer, you can schedule your sync times under Warehouses Settings. In addition, you might want to take advantage of Redshift’s Workload Management that helps ensure fast-running queries won’t get stuck behind long ones.
4. Default WLM Queue Configuration As mentioned before, Redshift schedules and prioritizes queries using Workload Management. Each queue is configured to distribute resources in ways that can optimize for your use-case.
The default configuration is a single queue with only 5 queries running concurrently, but we’ve discovered that the default only works well for very low-volume warehouses. More often than not, adjusting this configuration can significantly improve your sync times. Before our SQL statements, we use set query_group to "segment"; to group all of our queries together. This allows you to easily create a queue just for Segment that can be isolated from your own queries. The maximum concurrency that Redshift supports is 50 across all query groups, and resources like memory are distributed evenly across all those queries.
Our initial recommendation is for 2 WLM queues: a queue for the segment query group with a concurrency of 10 leave the default queue with a concurrency of 5
Generally, we are responsible for most writes in the databases we connect to, so having a higher concurrency allows us to write as quickly as possible. However, if you are also using the same database for your own ETL process, you may want to use the same concurrency for both groups. In addition, you may even require additional queues if you have other applications writing to the database. Each cluster may have different needs, so feel free to stray from this recommendation if another configuration works better for your use-case. AWS provides some guidelines, and of course you can always contact us as we’re more than happy to share what we have learned while working with Redshift.
Pro-tips for Segment Warehouses In addition to following performance best practices, here are a few more optimizations to consider if you’re using Segment Warehouses. Factors that affect load times When Segment is actively loading data into your data warehouse, we’re competing for cluster space and storage with any other jobs you might be running. Here are the parameters that influence your load time for Segment Warehouses.
Volume of data. Our pipeline needs to load and deduplicate data for each sync, so simply having more volume means these operations will take longer. Number of sources. When we start a sync of your data into your warehouse, we kick off a new job for every source you have in Segment. So the more sources you have, the longer your load time could take. This is where the WLM queue and the concurrency setting can make a big difference.
Number and size of columns. Column sizes and the number of columns also affect load time. If you have very long property values or lots of properties per event, the load may take longer as well. Performance optimizations To make sure you have enough headroom for quick queries while using Segment Warehouses, here are some tips! Size up your cluster. If you find your queries are getting slow at key times during the day, add more nodes to give enough room for us to load data and for your team to run their queries.
Disable unused sources. If you’re not actively analyzing data from a source, consider disabling the source for your Warehouse (available for business tier). If you don’t use a source anymore—perhaps you were just playing around with it for testing, you might even want to remove it completely. This will kick off fewer jobs in our ETL process. Schedule syncs during off times. If you’re concerned about query times and you don’t mind data that’s a little stale, you can schedule your syncs to run when most of your team isn’t actively using the database. (Available for business tier customers.)
Schedule regular vacuums. Make sure to schedule regular vacuums for your cluster, so old deleted data isn’t taking up space. We hope these steps will speed up your workflow! If you need any other help, feel free to contact us. This page was last modified: 24 Feb 2021 Need support? Questions? Problems? Need more info? Contact us, and we can help!
Visit our Support page Was this page helpful? Yes Thanks for your feedback! Can we improve this doc? Send us feedback! Get started with Segment Segment is the easiest way to integrate your websites & mobile apps data to over 300 analytics and growth tools.
Request Demo Create free account On this page Common Causes for Slow Queries Pro-tips for Segment Warehouses Was this page helpful? Yes Thanks for your feedback! Can we improve this doc? Send us feedback! Product
Connections Protocols Personas Integrations Catalog Pricing Security GDPR For Developers Documentation Segment API Build on Segment Open Source Engineering Team Company Careers
Blog Press FTFY Podcast Events Support Help Center Contact us Resources Recipes Security Bulletins Become a Partner © 2021 Segment.io, Inc. Privacy
